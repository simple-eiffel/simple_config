<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookbook - simple_config</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/simple-eiffel/claude_eiffel_op_docs/main/artwork/LOGO.png" alt="simple_* logo" class="logo">
        </div>
        <h1>simple_config</h1>
        <p class="tagline">Cookbook</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Overview</a></li>
            <li><a href="user-guide.html">User Guide</a></li>
            <li><a href="api-reference.html">API Reference</a></li>
            <li><a href="architecture.html">Architecture</a></li>
            <li><a href="cookbook.html" class="active">Cookbook</a></li>
            <li><a href="https://github.com/simple-eiffel/simple_config">GitHub</a></li>
        </ul>
    </nav>

    <main>
        <section id="intro">
            <h2>Cookbook</h2>
            <p>Ready-to-use recipes for common configuration patterns.</p>
        </section>

        <section id="recipe-1">
            <h2>Recipe 1: Database Configuration</h2>
            <p>Load database settings with environment override for production.</p>

            <h3>config.json</h3>
<pre><code>{
    "database": {
        "host": "localhost",
        "port": 5432,
        "name": "myapp_dev",
        "pool_size": 5
    }
}</code></pre>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">DATABASE_SETTINGS</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span>

    host: STRING
    port: INTEGER
    name: STRING
    pool_size: INTEGER

    make (a_config: <span class="type">SIMPLE_CONFIG</span>)
        <span class="keyword">do</span>
            <span class="comment">-- Environment variables override config in production</span>
            host := a_config.string_value_or_env_or_default (
                <span class="string">"database.host"</span>, <span class="string">"DB_HOST"</span>, <span class="string">"localhost"</span>)
            port := a_config.integer_value_or_env (
                <span class="string">"database.port"</span>, <span class="string">"DB_PORT"</span>, 5432)
            name := a_config.string_value_or_env_or_default (
                <span class="string">"database.name"</span>, <span class="string">"DB_NAME"</span>, <span class="string">"myapp"</span>)
            pool_size := a_config.integer_value_or_default (
                <span class="string">"database.pool_size"</span>, 10)
        <span class="keyword">end</span>

    connection_string: STRING
        <span class="keyword">do</span>
            Result := <span class="string">"host="</span> + host + <span class="string">" port="</span> + port.out +
                      <span class="string">" dbname="</span> + name
        <span class="keyword">end</span>

<span class="keyword">end</span></code></pre>
        </section>

        <section id="recipe-2">
            <h2>Recipe 2: Multi-Environment Config</h2>
            <p>Base config with environment-specific overrides.</p>

            <h3>config.json (base)</h3>
<pre><code>{
    "app": {
        "name": "MyApp",
        "debug": false,
        "log_level": "info"
    },
    "server": {
        "port": 8080,
        "host": "0.0.0.0"
    }
}</code></pre>

            <h3>config.development.json</h3>
<pre><code>{
    "app": {
        "debug": true,
        "log_level": "debug"
    }
}</code></pre>

            <h3>config.production.json</h3>
<pre><code>{
    "server": {
        "port": 80
    }
}</code></pre>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">local</span>
    config: <span class="type">SIMPLE_CONFIG</span>
    env: STRING
<span class="keyword">do</span>
    <span class="comment">-- Load base config</span>
    <span class="keyword">create</span> config.make_with_file (<span class="string">"config.json"</span>)

    <span class="comment">-- Get current environment</span>
    env := ((<span class="keyword">create</span> {<span class="type">SIMPLE_ENV</span>}).get (<span class="string">"APP_ENV"</span>)).to_string_8
    <span class="keyword">if</span> env = Void <span class="keyword">then</span>
        env := <span class="string">"development"</span>
    <span class="keyword">end</span>

    <span class="comment">-- Merge environment-specific config</span>
    config.merge_file (<span class="string">"config."</span> + env + <span class="string">".json"</span>)

    <span class="comment">-- Now config has merged values</span>
    print (<span class="string">"Debug: "</span> + config.boolean_value (<span class="string">"app.debug"</span>).out)
<span class="keyword">end</span></code></pre>
        </section>

        <section id="recipe-3">
            <h2>Recipe 3: Feature Flags</h2>
            <p>Toggle features on/off without code changes.</p>

            <h3>config.json</h3>
<pre><code>{
    "features": {
        "new_ui": false,
        "beta_api": false,
        "metrics": true,
        "cache": true
    }
}</code></pre>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">FEATURE_FLAGS</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span>

    config: <span class="type">SIMPLE_CONFIG</span>

    make (a_config: <span class="type">SIMPLE_CONFIG</span>)
        <span class="keyword">do</span>
            config := a_config
        <span class="keyword">end</span>

    is_enabled (a_feature: STRING): BOOLEAN
        <span class="keyword">do</span>
            Result := config.boolean_value_or_default (
                <span class="string">"features."</span> + a_feature, False)
        <span class="keyword">end</span>

    with_feature (a_feature: STRING; a_action: PROCEDURE)
        <span class="comment">-- Execute action only if feature is enabled</span>
        <span class="keyword">do</span>
            <span class="keyword">if</span> is_enabled (a_feature) <span class="keyword">then</span>
                a_action.call
            <span class="keyword">end</span>
        <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="comment">-- Usage</span>
flags.with_feature (<span class="string">"new_ui"</span>, <span class="keyword">agent</span> render_new_ui)
flags.with_feature (<span class="string">"metrics"</span>, <span class="keyword">agent</span> collect_metrics)</code></pre>
        </section>

        <section id="recipe-4">
            <h2>Recipe 4: Service Registry</h2>
            <p>Configure multiple service endpoints.</p>

            <h3>config.json</h3>
<pre><code>{
    "services": {
        "auth": {
            "url": "https://auth.example.com",
            "timeout": 30,
            "retries": 3
        },
        "storage": {
            "url": "https://storage.example.com",
            "timeout": 60,
            "retries": 5
        },
        "email": {
            "url": "https://email.example.com",
            "timeout": 10,
            "retries": 2
        }
    }
}</code></pre>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">SERVICE_REGISTRY</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span>

    config: <span class="type">SIMPLE_CONFIG</span>

    make (a_config: <span class="type">SIMPLE_CONFIG</span>)
        <span class="keyword">do</span>
            config := a_config
        <span class="keyword">end</span>

    service_url (a_service: STRING): STRING
        <span class="keyword">do</span>
            Result := config.string_value_or_default (
                <span class="string">"services."</span> + a_service + <span class="string">".url"</span>, <span class="string">""</span>)
        <span class="keyword">end</span>

    service_timeout (a_service: STRING): INTEGER
        <span class="keyword">do</span>
            Result := config.integer_value_or_default (
                <span class="string">"services."</span> + a_service + <span class="string">".timeout"</span>, 30)
        <span class="keyword">end</span>

    service_retries (a_service: STRING): INTEGER
        <span class="keyword">do</span>
            Result := config.integer_value_or_default (
                <span class="string">"services."</span> + a_service + <span class="string">".retries"</span>, 3)
        <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="comment">-- Usage</span>
registry.service_url (<span class="string">"auth"</span>)      <span class="comment">-- "https://auth.example.com"</span>
registry.service_timeout (<span class="string">"storage"</span>) <span class="comment">-- 60</span></code></pre>
        </section>

        <section id="recipe-5">
            <h2>Recipe 5: User Preferences with Save</h2>
            <p>Save user preferences to a config file.</p>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">USER_PREFERENCES</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span>

    config: <span class="type">SIMPLE_CONFIG</span>
    file_path: STRING

    make (a_path: STRING)
        <span class="keyword">do</span>
            file_path := a_path
            <span class="keyword">create</span> config.make_with_file (a_path)
        <span class="keyword">end</span>

    theme: STRING
        <span class="keyword">do</span>
            Result := config.string_value_or_default (<span class="string">"theme"</span>, <span class="string">"light"</span>)
        <span class="keyword">end</span>

    set_theme (a_theme: STRING)
        <span class="keyword">do</span>
            config.set_string (<span class="string">"theme"</span>, a_theme)
        <span class="keyword">end</span>

    font_size: INTEGER
        <span class="keyword">do</span>
            Result := config.integer_value_or_default (<span class="string">"font_size"</span>, 14)
        <span class="keyword">end</span>

    set_font_size (a_size: INTEGER)
        <span class="keyword">do</span>
            config.set_integer (<span class="string">"font_size"</span>, a_size)
        <span class="keyword">end</span>

    recent_files: ARRAYED_LIST [STRING]
        <span class="keyword">do</span>
            Result := config.string_list (<span class="string">"recent_files"</span>)
        <span class="keyword">end</span>

    save
        <span class="keyword">do</span>
            <span class="keyword">if</span> config.is_modified <span class="keyword">then</span>
                config.save
            <span class="keyword">end</span>
        <span class="keyword">end</span>

    is_dirty: BOOLEAN
        <span class="keyword">do</span>
            Result := config.is_modified
        <span class="keyword">end</span>

<span class="keyword">end</span></code></pre>
        </section>

        <section id="recipe-6">
            <h2>Recipe 6: Logging Configuration</h2>
            <p>Configure logging levels and handlers.</p>

            <h3>config.json</h3>
<pre><code>{
    "logging": {
        "level": "info",
        "handlers": {
            "console": {
                "enabled": true,
                "format": "[%level%] %message%"
            },
            "file": {
                "enabled": true,
                "path": "/var/log/myapp.log",
                "max_size_mb": 10,
                "rotate_count": 5
            }
        }
    }
}</code></pre>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">LOGGING_CONFIG</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span>

    level: STRING
    console_enabled: BOOLEAN
    console_format: STRING
    file_enabled: BOOLEAN
    file_path: STRING
    max_size_mb: INTEGER
    rotate_count: INTEGER

    make (a_config: <span class="type">SIMPLE_CONFIG</span>)
        <span class="keyword">do</span>
            level := a_config.string_value_or_default (<span class="string">"logging.level"</span>, <span class="string">"info"</span>)

            <span class="comment">-- Console handler</span>
            console_enabled := a_config.boolean_value_or_default (
                <span class="string">"logging.handlers.console.enabled"</span>, True)
            console_format := a_config.string_value_or_default (
                <span class="string">"logging.handlers.console.format"</span>, <span class="string">"[%level%] %message%"</span>)

            <span class="comment">-- File handler</span>
            file_enabled := a_config.boolean_value_or_default (
                <span class="string">"logging.handlers.file.enabled"</span>, False)
            file_path := a_config.string_value_or_default (
                <span class="string">"logging.handlers.file.path"</span>, <span class="string">"app.log"</span>)
            max_size_mb := a_config.integer_value_or_default (
                <span class="string">"logging.handlers.file.max_size_mb"</span>, 10)
            rotate_count := a_config.integer_value_or_default (
                <span class="string">"logging.handlers.file.rotate_count"</span>, 5)
        <span class="keyword">end</span>

<span class="keyword">end</span></code></pre>
        </section>

        <section id="recipe-7">
            <h2>Recipe 7: Validation on Load</h2>
            <p>Validate required configuration at startup.</p>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">CONFIG_VALIDATOR</span>

<span class="keyword">feature</span>

    validate (a_config: <span class="type">SIMPLE_CONFIG</span>): ARRAYED_LIST [STRING]
            <span class="comment">-- Return list of validation errors (empty if valid)</span>
        <span class="keyword">local</span>
            errors: ARRAYED_LIST [STRING]
        <span class="keyword">do</span>
            <span class="keyword">create</span> errors.make (0)

            <span class="comment">-- Required keys</span>
            <span class="keyword">if</span> <span class="keyword">not</span> a_config.has_key (<span class="string">"database.host"</span>) <span class="keyword">then</span>
                errors.extend (<span class="string">"Missing required: database.host"</span>)
            <span class="keyword">end</span>

            <span class="comment">-- Type validation</span>
            <span class="keyword">if</span> a_config.has_key (<span class="string">"server.port"</span>) <span class="keyword">then</span>
                <span class="keyword">if</span> a_config.integer_value (<span class="string">"server.port"</span>) <= 0 <span class="keyword">then</span>
                    errors.extend (<span class="string">"server.port must be positive"</span>)
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            <span class="comment">-- Range validation</span>
            <span class="keyword">if</span> a_config.integer_value (<span class="string">"pool_size"</span>) > 100 <span class="keyword">then</span>
                errors.extend (<span class="string">"pool_size cannot exceed 100"</span>)
            <span class="keyword">end</span>

            Result := errors
        <span class="keyword">end</span>

    validate_or_die (a_config: <span class="type">SIMPLE_CONFIG</span>)
            <span class="comment">-- Validate and exit if errors</span>
        <span class="keyword">local</span>
            errors: ARRAYED_LIST [STRING]
        <span class="keyword">do</span>
            errors := validate (a_config)
            <span class="keyword">if</span> <span class="keyword">not</span> errors.is_empty <span class="keyword">then</span>
                print (<span class="string">"Configuration errors:%N"</span>)
                <span class="keyword">across</span> errors <span class="keyword">as</span> e <span class="keyword">loop</span>
                    print (<span class="string">"  - "</span> + e + <span class="string">"%N"</span>)
                <span class="keyword">end</span>
                (<span class="keyword">create</span> {<span class="type">EXCEPTIONS</span>}).die (1)
            <span class="keyword">end</span>
        <span class="keyword">end</span>

<span class="keyword">end</span></code></pre>
        </section>

        <section id="recipe-8">
            <h2>Recipe 8: Hot Reload Configuration</h2>
            <p>Reload configuration without restarting application.</p>

            <h3>Eiffel Code</h3>
<pre><code><span class="keyword">class</span>
    <span class="type">HOT_RELOAD_CONFIG</span>

<span class="keyword">create</span>
    make

<span class="keyword">feature</span>

    config: <span class="type">SIMPLE_CONFIG</span>
    file_path: STRING
    on_reload: <span class="keyword">detachable</span> PROCEDURE [<span class="type">SIMPLE_CONFIG</span>]

    make (a_path: STRING)
        <span class="keyword">do</span>
            file_path := a_path
            <span class="keyword">create</span> config.make_with_file (a_path)
        <span class="keyword">end</span>

    set_on_reload (a_handler: PROCEDURE [<span class="type">SIMPLE_CONFIG</span>])
            <span class="comment">-- Set callback for reload events</span>
        <span class="keyword">do</span>
            on_reload := a_handler
        <span class="keyword">end</span>

    reload
            <span class="comment">-- Reload configuration from disk</span>
        <span class="keyword">do</span>
            config.load

            <span class="comment">-- Notify listeners</span>
            <span class="keyword">if</span> <span class="keyword">attached</span> on_reload <span class="keyword">as</span> handler <span class="keyword">then</span>
                handler.call ([config])
            <span class="keyword">end</span>
        <span class="keyword">end</span>

    check_and_reload
            <span class="comment">-- Check if file changed and reload if needed</span>
        <span class="keyword">local</span>
            l_file: <span class="type">SIMPLE_FILE</span>
        <span class="keyword">do</span>
            <span class="keyword">create</span> l_file.make (file_path)
            <span class="keyword">if</span> l_file.modified_timestamp > last_check <span class="keyword">then</span>
                reload
                last_check := l_file.modified_timestamp
            <span class="keyword">end</span>
        <span class="keyword">end</span>

    last_check: INTEGER_64

<span class="keyword">end</span>

<span class="comment">-- Usage</span>
hot_config.set_on_reload (<span class="keyword">agent</span> handle_config_change)
<span class="comment">-- In main loop or timer:</span>
hot_config.check_and_reload</code></pre>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 simple_* ecosystem. MIT License.</p>
        <p>
            <a href="https://github.com/simple-eiffel/simple_config">GitHub</a> |
            <a href="https://simple-eiffel.github.io">Documentation</a>
        </p>
    </footer>
</body>
</html>
